<div class="container m-5">
  <div class="row">
    <div class="col-md-8 offset-2">
    <h4>ショッピングカート</h4>
    <div class="alert alert-success" role="alert">
     <%= flash[:notice] %>
     </div>
      <% if @cart_items.exists?%>
    <table class="table table-bordered">
      <tr>
        <td>商品名</td>
        <td>単価(税込)</td>
        <td>数量</td>
        <td>小計</td>
        <td></td>
      </tr>
      <% total = 0 %>
      <% @cart_items.each do |cart|%>
      <tr>
        <td><%=cart.product.name%></td>
        <td><%=cart.product.add_tax_price.to_s(:delimited) %></td>
        <td><%= form_with model: cart, url: cart_item_path(cart),  method: :patch do |f| %>
           <%= f.number_field :product_count, min: 1, max:10, id: "product_count_cart"%>
           <%= f.submit "変更",class: "btn btn-success" %>
           <%end%></td>
        <td><% subtotal = ((cart.product.price*cart.product_count)*1.08).to_i %>　
         <%= subtotal.to_s(:delimited)  %></td> 
        <td><%= link_to '削除する', products_path,class: 'btn btn-danger' %></td>
      </tr>
        <% total += subtotal %>
      <%end%>
      <tr>  
      <td></td>
      <td></td>
      <td></td>
    <th>合計金額</th>
    <td><%= total.to_s(:delimited) %></td>
   </tr>
    </table>
    <%else%>
      <p>アイテムはありません。</p>
    <%end%>
    
    <%=form_with model: @order, url: orders_confirm_path, method: :post do |f|%>
    <%=f.submit '情報入力に進む',class: "btn btn-success" %>
    <%end%>
    
    </div>
  </div>
</div>